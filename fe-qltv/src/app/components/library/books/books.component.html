<div class="container mx-auto px-4 py-8">
  <h2 class="text-2xl font-bold mb-6">K·∫øt qu·∫£ t√¨m ki·∫øm s√°ch</h2>
  <div *ngIf="loading" class="text-gray-500">ƒêang t·∫£i...</div>
  <div *ngIf="error" class="text-red-500 mb-4">{{ error }}</div>
  <div *ngIf="books.length > 0">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      <div
        *ngFor="let book of books"
        class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow"
      >
        <div class="relative h-64">
          <img
            [src]="book.coverImage"
            [alt]="book.title"
            class="w-full h-full object-cover"
            (error)="$any($event.target).src = '/assets/default-book-cover.svg'"
          />
          <!-- Status Badge -->
          <div class="absolute top-2 right-2">
            <span
              class="px-2 py-1 rounded text-xs font-semibold"
              [ngClass]="getStatusClass(book.status || 'AVAILABLE')"
            >
              {{ getStatusText(book.status || 'AVAILABLE') }}
            </span>
          </div>
        </div>
        <div class="p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">{{ book.title }}</h3>
          <p class="text-gray-600 mb-1">{{ book.author }}</p>
          <p class="text-sm text-gray-500 mb-2">{{ book.genre }}</p>
          <p class="text-sm text-gray-500 mb-3">
            C√≤n l·∫°i: <span class="font-semibold">{{ book.availableCopies || 0 }}</span> /
            {{ book.totalCopies || 0 }}
          </p>

          <!-- Action Buttons -->
          <div class="flex gap-2 mt-3">
            <button
              (click)="openBookDetail(book)"
              class="flex-1 px-3 py-2 rounded bg-indigo-100 text-indigo-700 text-sm font-medium hover:bg-indigo-200 transition-colors"
            >
              üìñ Xem chi ti·∫øt
            </button>
            <button
              (click)="borrowBook(book)"
              [disabled]="(book?.availableCopies || 0) <= 0 || isProcessingPayment"
              class="flex-1 px-3 py-2 rounded bg-green-100 text-green-700 text-sm font-medium hover:bg-green-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              {{ isProcessingPayment ? '‚è≥' : 'üìö' }} M∆∞·ª£n s√°ch
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="!loading && books.length === 0 && !error" class="text-gray-500">
    Kh√¥ng c√≥ s√°ch n√†o ph√π h·ª£p.
  </div>
</div>

<!-- Book Detail Modal -->
<div
  *ngIf="showBookDetailModal && selectedBook"
  class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
  (click)="closeBookDetailModal()"
>
  <div
    class="bg-white rounded-lg max-w-2xl w-full p-6 shadow-2xl transform transition-all max-h-[90vh] overflow-y-auto"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="flex justify-between items-start mb-6">
      <h3 class="text-2xl font-bold text-gray-900">üìö Chi ti·∫øt s√°ch</h3>
      <button
        (click)="closeBookDetailModal()"
        class="text-gray-400 hover:text-gray-600 transition-colors"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>

    <!-- Content -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Book Cover -->
      <div class="md:col-span-1">
        <img
          [src]="selectedBook.coverImage"
          [alt]="selectedBook.title"
          class="w-full rounded-lg shadow-md"
          (error)="$any($event.target).src = '/assets/default-book-cover.svg'"
        />
        <div class="mt-3">
          <span
            class="inline-block px-3 py-1 rounded text-sm font-semibold"
            [ngClass]="getStatusClass(selectedBook.status || 'AVAILABLE')"
          >
            {{ getStatusText(selectedBook.status || 'AVAILABLE') }}
          </span>
        </div>
      </div>

      <!-- Book Info -->
      <div class="md:col-span-2">
        <h4 class="text-xl font-bold text-gray-900 mb-4">{{ selectedBook.title }}</h4>

        <div class="space-y-3">
          <div>
            <span class="text-sm text-gray-500">T√°c gi·∫£:</span>
            <p class="text-gray-900 font-medium">{{ selectedBook.author }}</p>
          </div>

          <div>
            <span class="text-sm text-gray-500">ISBN:</span>
            <p class="text-gray-900 font-medium">{{ selectedBook.isbn || 'N/A' }}</p>
          </div>

          <div>
            <span class="text-sm text-gray-500">Nh√† xu·∫•t b·∫£n:</span>
            <p class="text-gray-900 font-medium">{{ selectedBook.publisherName || 'N/A' }}</p>
          </div>

          <div>
            <span class="text-sm text-gray-500">Th·ªÉ lo·∫°i:</span>
            <p class="text-gray-900 font-medium">{{ selectedBook.genre || 'N/A' }}</p>
          </div>

          <div>
            <span class="text-sm text-gray-500">NƒÉm xu·∫•t b·∫£n:</span>
            <p class="text-gray-900 font-medium">{{ selectedBook.publicationYear || 'N/A' }}</p>
          </div>

          <div>
            <span class="text-sm text-gray-500">S·ªë l∆∞·ª£ng c√≤n l·∫°i:</span>
            <p class="text-gray-900 font-medium">
              {{ selectedBook.availableCopies || 0 }} / {{ selectedBook.totalCopies || 0 }}
            </p>
          </div>

          <div *ngIf="selectedBook.description">
            <span class="text-sm text-gray-500">M√¥ t·∫£:</span>
            <p class="text-gray-700 mt-1 text-sm leading-relaxed">
              {{ selectedBook.description }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Book Copies List -->
    <div *ngIf="selectedBook?.id" class="mt-6 border-t pt-4">
      <h4 class="text-lg font-semibold text-gray-900 mb-4">üìö Danh s√°ch b·∫£n sao</h4>
      <app-book-copies-list
        [bookId]="selectedBook.id!"
        [showActions]="false"
      ></app-book-copies-list>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-end space-x-3 pt-6 border-t mt-6">
      <button
        *ngIf="(selectedBook?.availableCopies || 0) > 0"
        (click)="borrowBook(selectedBook); closeBookDetailModal()"
        [disabled]="isProcessingPayment"
        class="px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors"
      >
        {{ isProcessingPayment ? '‚è≥ ƒêang x·ª≠ l√Ω...' : 'üìö M∆∞·ª£n s√°ch' }}
      </button>
      <button
        (click)="closeBookDetailModal()"
        class="px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-colors"
      >
        ƒê√≥ng
      </button>
    </div>
  </div>
</div>

<!-- Payment Method Modal -->
<app-payment-method-modal
  [show]="showPaymentModal"
  [bookTitle]="selectedBookForPayment?.title || ''"
  [depositAmount]="50000"
  (closeModal)="closePaymentModal()"
  (confirmPayment)="handleConfirmPayment($event)"
>
</app-payment-method-modal>
